<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flickr Slideshow â€” Minimal Crop & Zoom</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
<style>
:root {
  --gap: 16px;
  --slide-duration: 12s;
  --accent: #ff0084;
}
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; font-family: 'Montserrat', sans-serif; overflow: hidden; }
body {
  background: linear-gradient(to bottom, #0f1f2b, #333); /* darker gradient */
}

.stage {
  position: fixed;
  inset: 0;
  padding: 24px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.slide {
  position: absolute;
  inset: 24px 24px 110px 24px; /* leave footer */
  display: flex;
  flex-direction: column;
  justify-content: space-evenly;
  gap: var(--gap);
  opacity: 0;
  transition: opacity 800ms ease;
}
.slide.active {
  opacity: 1;
}

.row {
  display: flex;
  justify-content: center;
  gap: var(--gap);
}

.tile {
  position: relative;
  border-radius: 14px;
  overflow: hidden;
  background: #000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  opacity: 0;
  transform: translateY(20px) scale(0.98);
  animation: popin 800ms ease forwards;
}
.tile img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  animation: slowzoom 20s ease-in-out infinite alternate;
}
@keyframes popin {
  to { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes slowzoom {
  0% { transform: scale(1); }
  100% { transform: scale(1.08); }
}

/* Footer watermark */
.footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 110px;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 32px;
  border-top: 2px solid var(--accent);
  pointer-events: none;
}
.footer-text {
  font-size: 1.8rem;
  font-weight: 700;
  letter-spacing: 1px;
  color: white;
}
.footer-text span {
  color: var(--accent);
}
.footer-qr img {
  height: 85px;
  width: 85px;
  border-radius: 18px;
  background: white;
  padding: 6px;
}
</style>
</head>
<body>
<div class="stage" id="stage"></div>

<div class="footer">
  <div class="footer-text">Follow us on <span>Flickr</span> @sulamitachurchpdx</div>
  <div class="footer-qr">
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://www.flickr.com/photos/sulamitachurchpdx&ecc=Q" alt="Flickr QR Code">
  </div>
</div>

<script>
const CONFIG = {
  apiKey: "4855498d62dbadaf2bd11df6fcdb9f08",
  username: "sulamitachurchpdx",
  gap: 16,
  rowsPerSlide: 3,
  slideDurationMs: 12000,
  refreshMs: 300000
};

const stage = document.getElementById('stage');
let slides = [];
let slideIndex = 0;
let slideTimer = null;
let refreshTimer = null;

const daySec = 24*60*60;
const sevenDaysAgo = () => Math.floor(Date.now()/1000) - 7*daySec;

async function flickrFindNSID(apiKey, username){
  const url = new URL('https://www.flickr.com/services/rest/');
  url.searchParams.set('method','flickr.people.findByUsername');
  url.searchParams.set('api_key',apiKey);
  url.searchParams.set('username',username);
  url.searchParams.set('format','json');
  url.searchParams.set('nojsoncallback','1');
  const r = await fetch(url);
  const data = await r.json();
  return data.user.nsid;
}

async function flickrFetchRecent(apiKey, userId){
  const url = new URL('https://www.flickr.com/services/rest/');
  url.searchParams.set('method','flickr.photos.search');
  url.searchParams.set('api_key',apiKey);
  url.searchParams.set('user_id',userId);
  url.searchParams.set('min_upload_date', String(sevenDaysAgo()));
  url.searchParams.set('extras','url_m,url_l,url_o,width_m,height_m,width_l,height_l,o_dims,date_upload');
  url.searchParams.set('per_page','250');
  url.searchParams.set('page','1');
  url.searchParams.set('format','json');
  url.searchParams.set('nojsoncallback','1');
  const r = await fetch(url);
  const data = await r.json();
  return data.photos.photo;
}

function bestImage(p){
  let url = p.url_l || p.url_m || p.url_o || null;
  let w = p.width_l || p.width_m || p.width_o || null;
  let h = p.height_l || p.height_m || p.height_o || null;
  return url ? { url, w:Number(w), h:Number(h), title:p.title||'' } : null;
}

function buildRows(items, containerWidth, gap){
  const rows = [];
  let index = 0;
  while(index < items.length){
    const row = [];
    let rowWidth = 0;
    while(index < items.length && row.length < 5){ // max 5 per row for balance
      const item = items[index];
      const scale = 200 / item.h; // preliminary height scaling
      rowWidth += item.w * scale + (row.length>0 ? gap:0);
      if(rowWidth > containerWidth && row.length>0) break;
      row.push(item);
      index++;
    }
    if(row.length>0) rows.push(row);
    else index++;
  }
  return rows;
}

function createSlides(rows){
  const slides=[];
  for(let i=0;i<rows.length;i+=CONFIG.rowsPerSlide){
    const chunk = rows.slice(i,i+CONFIG.rowsPerSlide);
    if(chunk.length===CONFIG.rowsPerSlide) slides.push(chunk); // ignore incomplete
  }
  return slides;
}

function renderSlides(slides){
  stage.innerHTML='';
  const containerHeight = stage.clientHeight - 158; // footer space
  const rowHeight = (containerHeight - CONFIG.gap*(CONFIG.rowsPerSlide-1))/CONFIG.rowsPerSlide;
  slides.forEach(slideRows=>{
    const slide=document.createElement('div');
    slide.className='slide';
    slideRows.forEach(row=>{
      const rowEl=document.createElement('div');
      rowEl.className='row';
      row.forEach(it=>{
        const tile=document.createElement('div');
        tile.className='tile';
        tile.style.height=rowHeight+'px';
        // calculate width proportional to aspect ratio
        tile.style.width=(rowHeight * (it.w/it.h))+'px';
        const img=document.createElement('img');
        img.src=it.url;
        img.alt=it.title||'Flickr photo';
        tile.appendChild(img);
        rowEl.appendChild(tile);
      });
      slide.appendChild(rowEl);
    });
    stage.appendChild(slide);
  });
}

function showSlide(i){
  const all=Array.from(stage.children);
  all.forEach((el,idx)=>el.classList.toggle('active',idx===i));
}

async function loadAndRender(){
  const userId = await flickrFindNSID(CONFIG.apiKey, CONFIG.username);
  let photos = await flickrFetchRecent(CONFIG.apiKey,userId);
  photos.sort((a,b)=>Number(b.dateupload)-Number(a.dateupload));
  photos = photos.map(bestImage).filter(Boolean);

  const rows = buildRows(photos, stage.clientWidth, CONFIG.gap);
  slides = createSlides(rows);
  renderSlides(slides);
  slideIndex=0;
  showSlide(slideIndex);

  if(slideTimer) clearInterval(slideTimer);
  slideTimer=setInterval(()=>{
    slideIndex=(slideIndex+1)%slides.length;
    showSlide(slideIndex);
  }, CONFIG.slideDurationMs);

  if(refreshTimer) clearInterval(refreshTimer);
  refreshTimer=setInterval(()=>loadAndRender().catch(console.error), CONFIG.refreshMs);
}

window.addEventListener('resize', ()=>{
  if(!stage.children.length) return;
  loadAndRender().catch(console.error);
});

loadAndRender().catch(console.error);
</script>
</body>
</html>
